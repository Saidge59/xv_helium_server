#!/bin/bash

set -e
set -o pipefail

echo "Generating src/version.gen.h..."

HELIUM_SERVER_VERSION=$(./scripts/git-version -d .)
LIGHTWAY_CORE_VERSION=$(./scripts/git-version -d third_party/lightway_core)
WOLFSSL_VERSION=$(./scripts/git-version -d third_party/lightway_core/third_party/wolfssl)

cat > src/version.gen.h <<EOF
// DO NOT MODIFY - Generated by scripts/gen-version-header
#ifndef VERSION_GEN_H
#define VERSION_GEN_H

#define HELIUM_SERVER_VERSION "$HELIUM_SERVER_VERSION"
#define LIGHTWAY_CORE_VERSION "$LIGHTWAY_CORE_VERSION"
#define WOLFSSL_VERSION "$WOLFSSL_VERSION"

#endif  // VERSION_GEN_H
EOF

echo "Generated src/version.gen.h successfully!"
